#include <stdio.h>
#include <string.h>

struct File {
    char fname[20];
};

struct Directory {
    char dname[20];
    struct File files[10];
    int fcount;
};

int main() {
    struct Directory dir[10];
    int dcount = 0, i, j, choice;
    char d[20], f[20];

    while (1) {
        printf("\n\n---- Two Level Directory ----\n");
        printf("1. Create User Directory\n2. Create File\n3. Delete File\n4. Search File\n5. Display\n6. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1: // Create User Directory
                printf("Enter user directory name: ");
                scanf("%s", d);
                int exists = 0;
                for (i = 0; i < dcount; i++) {
                    if (strcmp(d, dir[i].dname) == 0) {
                        exists = 1;
                        break;
                    }
                }
                if (exists) {
                    printf("Error: User directory already exists!\n");
                } else {
                    strcpy(dir[dcount].dname, d);
                    dir[dcount].fcount = 0;
                    dcount++;
                    printf("User directory '%s' created.\n", d);
                }
                break;

            case 2: // Create File
                printf("Enter user directory name: ");
                scanf("%s", d);
                for (i = 0; i < dcount; i++) {
                    if (strcmp(d, dir[i].dname) == 0) {
                        printf("Enter file name: ");
                        scanf("%s", f);

                        int fexists = 0;
                        for (j = 0; j < dir[i].fcount; j++) {
                            if (strcmp(f, dir[i].files[j].fname) == 0) {
                                fexists = 1;
                                break;
                            }
                        }

                        if (fexists) {
                            printf("Error: File already exists in '%s'!\n", d);
                        } else {
                            strcpy(dir[i].files[dir[i].fcount].fname, f);
                            dir[i].fcount++;
                            printf("File '%s' created in directory '%s'.\n", f, d);
                        }
                        break;
                    }
                }
                if (i == dcount) {
                    printf("Error: User directory not found!\n");
                }
                break;

            case 3: // Delete File
                printf("Enter user directory name: ");
                scanf("%s", d);
                for (i = 0; i < dcount; i++) {
                    if (strcmp(d, dir[i].dname) == 0) {
                        printf("Enter file name to delete: ");
                        scanf("%s", f);
                        int found = 0;
                        for (j = 0; j < dir[i].fcount; j++) {
                            if (strcmp(f, dir[i].files[j].fname) == 0) {
                                found = 1;
                                strcpy(dir[i].files[j].fname, dir[i].files[dir[i].fcount - 1].fname);
                                dir[i].fcount--;
                                printf("File '%s' deleted from directory '%s'.\n", f, d);
                                break;
                            }
                        }
                        if (!found) printf("Error: File not found!\n");
                        break;
                    }
                }
                if (i == dcount) printf("Error: User directory not found!\n");
                break;

            case 4: // Search File
                printf("Enter user directory name: ");
                scanf("%s", d);
                for (i = 0; i < dcount; i++) {
                    if (strcmp(d, dir[i].dname) == 0) {
                        printf("Enter file name to search: ");
                        scanf("%s", f);
                        int found = 0;
                        for (j = 0; j < dir[i].fcount; j++) {
                            if (strcmp(f, dir[i].files[j].fname) == 0) {
                                found = 1;
                                printf("File '%s' found in directory '%s'.\n", f, d);
                                break;
                            }
                        }
                        if (!found) printf("Error: File not found!\n");
                        break;
                    }
                }
                if (i == dcount) printf("Error: User directory not found!\n");
                break;

            case 5: // Display
                if (dcount == 0) {
                    printf("No user directories exist.\n");
                } else {
                    for (i = 0; i < dcount; i++) {
                        printf("User Directory: %s\n", dir[i].dname);
                        if (dir[i].fcount == 0) {
                            printf("  (No files)\n");
                        } else {
                            for (j = 0; j < dir[i].fcount; j++) {
                                printf("  %s\n", dir[i].files[j].fname);
                            }
                        }
                    }
                }
                break;

            case 6: // Exit
                return 0;

            default:
                printf("Invalid choice!\n");
        }
    }
}
